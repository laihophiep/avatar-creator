<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• T√≠nh Ng√†y R·ª•ng Tr·ª©ng</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 700px;
            background-color: #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        .calculator-tool {
            background-color: #fce4ec;
            color: black;
            padding: 25px;
            border-radius: 10px 10px 0 0;
            text-align: center;
        }
        .calculator-tool h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        .calculator-tool p {
            margin: 0 0 20px 0;
            font-size: 14px;
            opacity: 0.9;
        }
        .input-form {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            gap: 10px;
            flex-wrap: wrap;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 110px;
        }
        .form-group label {
            font-size: 12px;
            margin-bottom: 5px;
            height: 25px;
        }
        .form-group select {
            padding: 8px;
            border-radius: 5px;
            border: none;
            width: 100%;
            text-align: center;
        }
        #calculate-btn, #recalculate-btn {
            background-color: #cc0000;
            color: white;
            border: 2px solid white;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        #calculate-btn:hover, #recalculate-btn:hover {
            background-color: #ff3333;
        }

        #results-container {
            padding: 20px;
        }
        .results-header {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #e50000;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }
        .calendar-header {
            font-weight: bold;
            color: #555;
            padding-bottom: 10px;
        }
        .calendar-day {
            position: relative; 
            aspect-ratio: 1 / 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .calendar-day.other-month {
            color: #ccc;
        }
        .calendar-day .day-icon {
            position: absolute;
            bottom: 5px;
            font-size: 16px;
        }
        .day-period { background-color: #e3f2fd; }
        .day-fertile { background-color: #ffebee; }
        .day-ovulation { background-color: #fce4ec; border: 2px solid #e50000; }
        .day-implantation { background-color: #e0f7fa; }
        .day-test { background-color: #f3e5f5; }

        [data-tooltip] {
            position: relative;
            cursor: pointer;
        }
        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 105%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 10;
        }
        [data-tooltip]:hover::after {
            opacity: 1;
            visibility: visible;
        }

        .event-list {
            margin-top: 30px;
        }
        .event-item {
            display: flex;
            align-items: center;
            padding: 15px 5px;
            border-bottom: 1px solid #eee;
        }
        .event-icon {
            font-size: 24px;
            margin-right: 15px;
            width: 30px;
            text-align: center;
            color: #e50000;
        }
        .event-details h3 {
            margin: 0;
            font-size: 15px;
            font-weight: bold;
        }
        .event-details p {
            margin: 5px 0 0 0;
            font-size: 13px;
            color: #666;
        }
        
        #recalculate-btn-container {
            text-align: center;
            margin-top: 20px;
        }

    </style>
</head>
<body>

    <div class="app-container">
        <div class="calculator-tool">
            <h1><span style="font-size: 30px;">üïî</span> C√¥ng c·ª• t√≠nh ng√†y r·ª•ng tr·ª©ng</h1>
            <p>H√£y c√πng t√¨m hi·ªÉu v·ªÅ c√°c giai ƒëo·∫°n trong qu√° tr√¨nh r·ª•ng tr·ª©ng v√† d·ª± ƒëo√°n th·ªùi gian th·ª• thai t·ªët nh·∫•t v·ªõi c√¥ng c·ª• c·ªßa ch√∫ng t√¥i.</p>
            <div id="input-section">
                <div class="input-form">
                    <div class="form-group">
                        <label for="day-select">Ng√†y ƒë·∫ßu ti√™n c·ªßa k·ª≥ kinh cu·ªëi</label>
                        <select id="day-select"></select>
                    </div>
                    <div class="form-group">
                        <label for="month-select">Th√°ng</label>
                        <select id="month-select"></select>
                    </div>
                    <div class="form-group">
                        <label for="cycle-select">Chu k·ª≥ kinh nguy·ªát</label>
                        <select id="cycle-select"></select>
                    </div>
                    <div class="form-group">
                        <label for="luteal-select">Giai ƒëo·∫°n sau r·ª•ng tr·ª©ng</label>
                        <select id="luteal-select"></select>
                    </div>
                </div>
                <button id="calculate-btn">T√≠nh to√°n ngay</button>
            </div>
        </div>

        <div id="results-container" style="display: none;">
            <div id="results-header" class="results-header"></div>
            <div class="calendar-grid">
                <div class="calendar-header">CN</div>
                <div class="calendar-header">T2</div>
                <div class="calendar-header">T3</div>
                <div class="calendar-header">T4</div>
                <div class="calendar-header">T5</div>
                <div class="calendar-header">T6</div>
                <div class="calendar-header">T7</div>
            </div>
            <div id="calendar-body" class="calendar-grid"></div>
            <div id="event-list" class="event-list"></div>
            <div id="recalculate-btn-container">
                <button id="recalculate-btn">T√≠nh to√°n l·∫°i</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const daySelect = document.getElementById('day-select');
            const monthSelect = document.getElementById('month-select');
            const cycleSelect = document.getElementById('cycle-select');
            const lutealSelect = document.getElementById('luteal-select');

            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            const currentDay = new Date().getDate();

            for (let i = 1; i <= 31; i++) {
                daySelect.innerHTML += `<option value="${i}">${i}</option>`;
            }

            for (let i = 1; i <= 12; i++) {
                monthSelect.innerHTML += `<option value="${i}">Th√°ng ${i}</option>`;
            }

            for (let i = 20; i <= 45; i++) {
                cycleSelect.innerHTML += `<option value="${i}" ${i === 28 ? 'selected' : ''}>${i} ng√†y</option>`;
            }
            
            for (let i = 10; i <= 18; i++) {
                lutealSelect.innerHTML += `<option value="${i}" ${i === 14 ? 'selected' : ''}>${i} ng√†y</option>`;
            }

            daySelect.value = currentDay;
            monthSelect.value = currentMonth;

            document.getElementById('calculate-btn').addEventListener('click', calculateAndDisplay);
            document.getElementById('recalculate-btn').addEventListener('click', () => {
                document.getElementById('results-container').style.display = 'none';
                document.querySelector('.calculator-tool').style.display = 'block';
            });
        });

        const addDays = (date, days) => {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        };
        const formatDate = (date) => `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;

        function calculateAndDisplay() {
            const day = parseInt(document.getElementById('day-select').value);
            const month = parseInt(document.getElementById('month-select').value);
            const cycleLength = parseInt(document.getElementById('cycle-select').value);
            const lutealPhase = parseInt(document.getElementById('luteal-select').value);
            const year = new Date().getFullYear();

            const lastPeriodDate = new Date(year, month - 1, day);
            
            const ovulationDate = addDays(lastPeriodDate, cycleLength - lutealPhase);
            const nextPeriodDate = addDays(lastPeriodDate, cycleLength);
            
            const fertileStart = addDays(ovulationDate, -3);
            const fertileEnd = addDays(ovulationDate, 1);
            
            const implantationDate = addDays(ovulationDate, 3);
            const testDate = addDays(ovulationDate, 11);
            
            const dueDate = addDays(lastPeriodDate, 280);
            const endFirstTrimester = addDays(lastPeriodDate, 90);
            const endSecondTrimester = addDays(lastPeriodDate, 189);
            
            // ‚ñº‚ñº‚ñº THAY ƒê·ªîI: B·ªï sung l·∫°i m√¥ t·∫£ (desc) cho t·∫•t c·∫£ c√°c s·ª± ki·ªán ‚ñº‚ñº‚ñº
            const events = [
                { date: lastPeriodDate, icon: 'üíß', title: `Ng√†y b·∫Øt ƒë·∫ßu k·ª≥ kinh nguy·ªát`, desc: `ƒê√¢y l√† ng√†y b·∫Øt ƒë·∫ßu kinh nguy·ªát c·ªßa b·∫°n.`, type: 'period' },
                { date: fertileStart, icon: '‚ù§Ô∏è', title: `Ng√†y b·∫Øt ƒë·∫ßu c√≥ kh·∫£ nƒÉng th·ª• thai`, desc: `ƒê√¢y l√† ng√†y b·∫Øt ƒë·∫ßu giai ƒëo·∫°n b·∫°n c√≥ kh·∫£ nƒÉng th·ª• thai.`, type: 'fertile' },
                { date: addDays(fertileStart, 1), icon: '‚ù§Ô∏è', title: `Ng√†y c√≥ kh·∫£ nƒÉng th·ª• thai`, desc: `Hai ng√†y tr∆∞·ªõc khi tr·ª©ng r·ª•ng, b·∫°n c√≥ kh·∫£ nƒÉng th·ª• thai v√†o ng√†y n√†y.`, type: 'fertile' },
                { date: addDays(fertileStart, 2), icon: '‚ù§Ô∏è', title: `Ng√†y c√≥ kh·∫£ nƒÉng th·ª• thai`, desc: `M·ªôt ng√†y tr∆∞·ªõc khi tr·ª©ng r·ª•ng, b·∫°n c√≥ nhi·ªÅu kh·∫£ nƒÉng th·ª• thai v√†o ng√†y n√†y.`, type: 'fertile' },
                { date: ovulationDate, icon: 'üíñ', title: `Ng√†y c√≥ kh·∫£ nƒÉng th·ª• thai cao nh·∫•t`, desc: `ƒê√¢y l√† ng√†y tr·ª©ng r·ª•ng n√™n kh·∫£ nƒÉng th·ª• thai v√†o ng√†y n√†y l√† cao nh·∫•t.`, type: 'ovulation' },
                { date: fertileEnd, icon: '‚ù§Ô∏è', title: `Ng√†y c√≥ kh·∫£ nƒÉng th·ª• thai`, desc: `M·ªôt ng√†y sau khi tr·ª©ng r·ª•ng, b·∫°n c√≥ kh·∫£ nƒÉng th·ª• thai r·∫•t l·ªõn v√†o ng√†y n√†y.`, type: 'fertile' },
                { date: addDays(ovulationDate, 2), icon: 'Àî', title: `Ng√†y kh·∫£ nƒÉng th·ª• thai gi·∫£m`, desc: `Hai ng√†y sau khi tr·ª©ng r·ª•ng, kh·∫£ nƒÉng th·ª• thai v√†o ng√†y n√†y gi·∫£m.`, type: 'other' },
                { date: implantationDate, icon: 'üëç', title: `Ng√†y c·∫•y gh√©p`, desc: `N·∫øu tr·ª©ng ƒë∆∞·ª£c th·ª• tinh th√†nh c√¥ng, ƒë√¢y l√† ng√†y g·∫ßn ƒë√∫ng ƒë·ªÉ l√†m t·ªï.`, type: 'implantation' },
                { date: testDate, icon: 'üî¨', title: `Th·ª≠ thai`, desc: `B·∫°n c√≥ th·ªÉ d√πng que th·ª≠ thai ƒë·ªÉ ki·ªÉm tra k·∫øt qu·∫£ t·ª´ ng√†y n√†y.`, type: 'test' },
                { date: nextPeriodDate, icon: 'üíß', title: `Ng√†y b·∫Øt ƒë·∫ßu k·ª≥ kinh nguy·ªát ti·∫øp theo`, desc: `D·ª± ki·∫øn chu k·ª≥ ti·∫øp theo c·ªßa b·∫°n s·∫Ω b·∫Øt ƒë·∫ßu v√†o ng√†y n√†y.`, type: 'period' },
                { date: endFirstTrimester, icon: 'üóìÔ∏è', title: `K·∫øt th√∫c qu√Ω ƒë·∫ßu ti√™n`, desc: `Ch√∫c m·ª´ng, b·∫°n ƒë√£ ho√†n th√†nh 3 th√°ng ƒë·∫ßu c·ªßa thai k·ª≥.`, type: 'milestone' },
                { date: endSecondTrimester, icon: 'üóìÔ∏è', title: `Cu·ªëi qu√Ω hai`, desc: `B·∫°n ƒë√£ ƒëi ƒë∆∞·ª£c 2/3 ch·∫∑ng ƒë∆∞·ªùng c·ªßa thai k·ª≥.`, type: 'milestone' },
                { date: dueDate, icon: 'üòä', title: `Ng√†y sinh g·∫ßn ƒë√∫ng`, desc: `ƒê√¢y l√† ng√†y d·ª± ki·∫øn ch√†o ƒë√≥n em b√© c·ªßa b·∫°n.`, type: 'milestone' },
            ];
            
            events.sort((a, b) => a.date - b.date);

            generateCalendar(lastPeriodDate, events);
            generateEventList(events);

            document.getElementById('results-container').style.display = 'block';
            document.querySelector('.calculator-tool').style.display = 'none';
        }

        function generateCalendar(startDate, events) {
            const calendarBody = document.getElementById('calendar-body');
            const resultsHeader = document.getElementById('results-header');
            calendarBody.innerHTML = '';
            
            const monthNames = ["Th√°ng 1", "Th√°ng 2", "Th√°ng 3", "Th√°ng 4", "Th√°ng 5", "Th√°ng 6", "Th√°ng 7", "Th√°ng 8", "Th√°ng 9", "Th√°ng 10", "Th√°ng 11", "Th√°ng 12"];
            resultsHeader.textContent = `${monthNames[startDate.getMonth()]} - ${startDate.getFullYear()}`;

            let calendarStartDay = new Date(startDate);
            calendarStartDay.setDate(1);
            let dayOfWeek = calendarStartDay.getDay();
            calendarStartDay = addDays(calendarStartDay, -dayOfWeek);
            
            for (let i = 0; i < 42; i++) {
                const day = addDays(calendarStartDay, i);
                const dayCell = document.createElement('div');
                dayCell.classList.add('calendar-day');
                dayCell.textContent = day.getDate();
                
                if (day.getMonth() !== startDate.getMonth()) {
                    dayCell.classList.add('other-month');
                }

                const dayEvents = events.filter(e => e.date.toDateString() === day.toDateString());
                if(dayEvents.length > 0) {
                    const primaryEvent = dayEvents.sort((a,b) => a.type === 'ovulation' ? -1 : 1)[0];
                    dayCell.classList.add(`day-${primaryEvent.type}`);
                    // Ch·ªâ hi·ªÉn th·ªã icon cho c√°c s·ª± ki·ªán c√≥ icon, tr·ª´ icon '‚ûñ'
                    if(primaryEvent.icon && primaryEvent.icon !== '‚ûñ') {
                       const iconSpan = document.createElement('span');
                       iconSpan.className = 'day-icon';
                       iconSpan.textContent = primaryEvent.icon;
                       dayCell.appendChild(iconSpan);
                    }
                    dayCell.setAttribute('data-tooltip', primaryEvent.title);
                }
                
                calendarBody.appendChild(dayCell);
            }
        }
        
        // ‚ñº‚ñº‚ñº THAY ƒê·ªîI: H√ÄM N√ÄY ƒê∆Ø·ª¢C QUAY L·∫†I PHI√äN B·∫¢N HI·ªÇN TH·ªä T·∫§T C·∫¢ ‚ñº‚ñº‚ñº
        function generateEventList(events) {
            const listContainer = document.getElementById('event-list');
            listContainer.innerHTML = '';

            // 1. T·∫°o m·ªôt danh s√°ch c√°c s·ª± ki·ªán duy nh·∫•t trong ng√†y ƒë·ªÉ hi·ªÉn th·ªã
            const uniqueEvents = [];
            const seenDates = new Set();
            events.forEach(event => {
                if (!seenDates.has(event.date.toDateString())) {
                    uniqueEvents.push(event);
                    seenDates.add(event.date.toDateString());
                }
            });

            // 2. Hi·ªÉn th·ªã t·∫•t c·∫£ c√°c s·ª± ki·ªán duy nh·∫•t ƒë√≥
            for(const event of uniqueEvents) {
                // Ch·ªâ hi·ªÉn th·ªã nh·ªØng s·ª± ki·ªán c√≥ m√¥ t·∫£ (desc)
                if (event.desc) {
                    const item = document.createElement('div');
                    item.className = 'event-item';
                    const icon = event.icon === '‚ûñ' ? 'üóìÔ∏è' : event.icon; // Thay icon '‚ûñ' b·∫±ng icon l·ªãch
                    item.innerHTML = `
                        <div class="event-icon">${icon}</div>
                        <div class="event-details">
                            <h3>${formatDate(event.date)} - ${event.title}</h3>
                            <p>${event.desc}</p>
                        </div>
                    `;
                    listContainer.appendChild(item);
                }
            }
        }
        // ‚ñ≤‚ñ≤‚ñ≤ K·∫æT TH√öC PH·∫¶N THAY ƒê·ªîI ‚ñ≤‚ñ≤‚ñ≤

    </script>

</body>
</html>