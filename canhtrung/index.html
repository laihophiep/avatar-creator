<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Tính Ngày Rụng Trứng Toàn Diện</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 800px;
            background-color: #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .calculator-tool {
            background-color: #fdf2f8;
            color: #9d174d;
            padding: 30px 25px;
            text-align: center;
        }
        .calculator-tool h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 700;
            color: #be185d;
        }
        .calculator-tool p {
            margin: 0 0 25px 0;
            font-size: 15px;
            color: #831843;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .cycle-type-selector {
            background-color: #f3f4f6;
            border-radius: 30px;
            padding: 5px;
            margin: 0 auto 25px auto;
            display: inline-flex;
            gap: 5px;
            border: 1px solid #fce7f3;
        }
        .cycle-type-selector label { cursor: pointer; }
        .cycle-type-selector input { display: none; }
        .cycle-type-selector span {
            display: block;
            padding: 10px 25px;
            border-radius: 25px;
            transition: all 0.3s ease-in-out;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
        }
        .cycle-type-selector input:checked + span {
            background-color: #fff;
            color: #be185d;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .input-form { display: flex; justify-content: center; align-items: flex-end; gap: 10px; flex-wrap: wrap; }
        .form-group { display: flex; flex-direction: column; align-items: center; min-width: 120px; padding: 5px; }
        .form-group label { font-size: 13px; margin-bottom: 8px; font-weight: 500; color: #9d174d; }
        .form-group select, .form-group input[type="number"] {
            padding: 10px; border-radius: 8px; border: 1px solid #fbcfe8; width: 100%; text-align: center; box-sizing: border-box;
            background-color: #fff;
        }
        
        #calculate-btn, #recalculate-btn {
            background-color: #e11d48;
            color: white; 
            border: none;
            padding: 14px 30px;
            border-radius: 30px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold; 
            margin-top: 25px; 
            transition: background-color 0.3s;
            box-shadow: 0 4px 10px rgba(225, 29, 72, 0.2);
        }
        #calculate-btn:hover, #recalculate-btn:hover { 
            background-color: #f43f5e; 
        }
        #recalculate-btn {
             background-color: #db2777;
        }
        #recalculate-btn:hover {
            background-color: #e85bad;
        }

        #results-container { padding: 25px; }
        .results-header { text-align: center; font-size: 18px; font-weight: bold; color: #be185d; margin-bottom: 15px; text-transform: uppercase; }
        #calendars-container { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .calendar-wrapper { flex: 1; min-width: 300px; margin-bottom: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; }
        .calendar-header { font-weight: bold; color: #555; padding-bottom: 10px; font-size: 13px;}
        .calendar-day { position: relative; aspect-ratio: 1 / 1; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 13px; border-radius: 8px; background-color: #f9f9f9; }
        .calendar-day.other-month { color: #ccc; }
        .calendar-day .day-number { margin-bottom: 2px; }
        .calendar-day .day-icon { font-size: 16px; height: 18px; }
        .calendar-day.day-fertile-range { background-color: #ffebee; }
        .calendar-day.day-period { background-color: #e3f2fd; }
        .calendar-day.day-ovulation { background-color: #fce4ec; border: 2px solid #e50000; font-weight: bold; }
        .calendar-day.day-implantation { background-color: #e0f7fa; }
        .calendar-day.day-test { background-color: #f3e5f5; }
        
     /*   [data-tooltip] { position: relative; cursor: pointer; }
        [data-tooltip]:not([data-tooltip=""])::before {
    content: attr(data-tooltip);
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: #fff;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    z-index: 10;
}
        [data-tooltip]:not([data-tooltip=""])::after {
    content: '';
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid #333;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    z-index: 10;
}
        /* Hiển thị tooltip khi di chuột */
       /* [data-tooltip]:not([data-tooltip=""]):hover::before,
        [data-tooltip]:not([data-tooltip=""]):hover::after {
            opacity: 1;
            visibility: visible;
        }*/
        /* ▲▲▲ KẾT THÚC CSS TOOLTIP ▲▲▲ */*/
/* ▼▼▼ CSS CHO TOOLTIP (NÂNG CẤP) ▼▼▼ */
       /* [data-tooltip]:not([data-tooltip=""]) {
            position: relative;
            cursor: pointer;
        }
        [data-tooltip]:not([data-tooltip=""])::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px); 
            background-color: #333;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, transform 0.3s;
            z-index: 10;
            pointer-events: none; /* Tránh tooltip tự che nó */
        }*/
        /* Hiển thị tooltip khi di chuột (cho máy tính) HOẶC khi có class .tooltip-visible (cho mobile) */
      /*  [data-tooltip]:not([data-tooltip=""]):hover::after,
        [data-tooltip].tooltip-visible::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-12px);*/ /* Hiệu ứng nảy lên */
        /*}*/
        /* ▼▼▼ CSS MỚI CHO TOOLTIP CÓ MŨI TÊN ▼▼▼ */
        [data-tooltip]:not([data-tooltip=""]) {
            position: relative;
            cursor: pointer;
        }
        /* Hộp văn bản của tooltip (dùng ::before) */
        [data-tooltip]:not([data-tooltip=""])::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 5px); /* Vị trí phía trên mũi tên */
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            
            /* Trạng thái ẩn ban đầu */
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none; 
        }
        /* Mũi tên của tooltip (dùng ::after) */
        [data-tooltip]:not([data-tooltip=""])::after {
            content: '';
            position: absolute;
            bottom: 100%; 
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #333; /* Đây là hình tam giác */
            
            /* Trạng thái ẩn ban đầu */
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        /* Quy tắc hiển thị cho cả hộp và mũi tên */
        [data-tooltip]:not([data-tooltip=""]):hover::before,
        [data-tooltip]:not([data-tooltip=""]):hover::after,
        [data-tooltip].tooltip-visible::before,
        [data-tooltip].tooltip-visible::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-6px); /* Hiệu ứng nảy lên */
        }
        /* ▲▲▲ KẾT THÚC CSS TOOLTIP ▲▲▲ */
        .event-list { margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px; }
        .event-item { display: flex; align-items: flex-start; padding: 15px 5px; border-bottom: 1px solid #eee; }
        .event-icon { font-size: 24px; margin-right: 15px; width: 30px; text-align: center; color: #be185d; padding-top: 3px; }
        .event-details h3 { margin: 0; font-size: 15px; font-weight: bold; }
        .event-details p { margin: 5px 0 0 0; font-size: 13px; color: #666; }
        #recalculate-btn-container { text-align: center; margin-top: 20px; }
         .des-tool-ovulation {margin-bottom: 15px}

    </style>
</head>
<body>

    <div class="app-container">
        <div class="calculator-tool">
           <div class="tool-title"><img scr=""><h1>Công cụ tính ngày rụng trứng</h1></div>
            <div class="des-tool-ovulation">Bạn đã biết cách tính ngày rụng trứng? Hãy cùng tìm hiểu về các giai đoạn trong quá trình rụng trứng và dự đoán thời gian thụ thai tốt nhất với công cụ tính ngày rụng trứng</div>
            <div class="cycle-type-selector">
                <label> 
                    <input type="radio" name="cycleType" value="regular" checked> 
                    <span>Chu kỳ đều</span> 
                </label>
                <label> 
                    <input type="radio" name="cycleType" value="irregular"> 
                    <span>Chu kỳ không đều</span> 
                </label>
            </div>

            <p>Hãy chọn loại chu kỳ và điền thông tin để dự đoán thời gian thụ thai tốt nhất.</p>

            <div id="input-section">
                <div id="regular-cycle-inputs" class="input-form">
                    <div class="form-group"> <label>Ngày đầu của kỳ kinh cuối</label> <select id="day-select"></select> </div>
                    <div class="form-group"> <label>Tháng</label> <select id="month-select"></select> </div>
                    <div class="form-group"> <label>Chu kỳ kinh nguyệt</label> <select id="cycle-select"></select> </div>
                    <div class="form-group"> <label>Giai đoạn sau rụng trứng</label> <select id="luteal-select"></select> </div>
                </div>

                <div id="irregular-cycle-inputs" class="input-form" style="display: none;">
                    <div class="form-group"> <label>Ngày đầu của kỳ kinh cuối</label> <select id="day-select-irregular"></select> </div>
                    <div class="form-group"> <label>Tháng</label> <select id="month-select-irregular"></select> </div>
                    <div class="form-group"> <label>Chu kỳ ngắn nhất (6 tháng)</label> <input type="number" id="shortest-cycle" value="26" min="20"> </div>
                    <div class="form-group"> <label>Chu kỳ dài nhất (6 tháng)</label> <input type="number" id="longest-cycle" value="32" min="20"> </div>
                </div>
                <button id="calculate-btn">Tính toán ngay</button>
            </div>
            <div style="text-align: center;margin-top: 20px;">#Được Tạo by Mr.Hiệp</div>
        </div>
        <div id="results-container" style="display: none;">
             </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const daySelect = document.getElementById('day-select');
            const monthSelect = document.getElementById('month-select');
            const cycleSelect = document.getElementById('cycle-select');
            const lutealSelect = document.getElementById('luteal-select');
            const daySelectIrregular = document.getElementById('day-select-irregular');
            const monthSelectIrregular = document.getElementById('month-select-irregular');

            const today = new Date();
            for (let i = 1; i <= 31; i++) {
                const option = `<option value="${i}">${i}</option>`;
                daySelect.innerHTML += option;
                daySelectIrregular.innerHTML += option;
            }
            for (let i = 1; i <= 12; i++) {
                const option = `<option value="${i}">Tháng ${i}</option>`;
                monthSelect.innerHTML += option;
                monthSelectIrregular.innerHTML += option;
            }
            for (let i = 20; i <= 45; i++) {
                cycleSelect.innerHTML += `<option value="${i}" ${i === 28 ? 'selected' : ''}>${i} ngày</option>`;
            }
            for (let i = 10; i <= 18; i++) {
                lutealSelect.innerHTML += `<option value="${i}" ${i === 14 ? 'selected' : ''}>${i} ngày</option>`;
            }
            daySelect.value = today.getDate();
            monthSelect.value = today.getMonth() + 1;
            daySelectIrregular.value = today.getDate();
            monthSelectIrregular.value = today.getMonth() + 1;

            const regularInputs = document.getElementById('regular-cycle-inputs');
            const irregularInputs = document.getElementById('irregular-cycle-inputs');
            document.querySelectorAll('input[name="cycleType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'regular') {
                        regularInputs.style.display = 'flex';
                        irregularInputs.style.display = 'none';
                    } else {
                        regularInputs.style.display = 'none';
                        irregularInputs.style.display = 'flex';
                    }
                });
            });

            document.getElementById('calculate-btn').addEventListener('click', calculateAndDisplay);
        });

        const addDays = (date, days) => {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        };
        const formatDate = (date) => `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        const daysBetween = (date1, date2) => Math.ceil(Math.abs(date2 - date1) / (1000 * 60 * 60 * 24));

        function calculateAndDisplay() {
            const cycleType = document.querySelector('input[name="cycleType"]:checked').value;
            let events = [];
            let lastPeriodDate;
            let fertileWindow = {};
            const year = new Date().getFullYear();

            if (cycleType === 'regular') {
                const day = parseInt(document.getElementById('day-select').value);
                const month = parseInt(document.getElementById('month-select').value);
                const cycleLength = parseInt(document.getElementById('cycle-select').value);
                const lutealPhase = parseInt(document.getElementById('luteal-select').value);
                lastPeriodDate = new Date(year, month - 1, day);

                const ovulationDate = addDays(lastPeriodDate, cycleLength - lutealPhase);
                const nextPeriodDate = addDays(lastPeriodDate, cycleLength);
                fertileWindow.start = addDays(ovulationDate, -5);
                fertileWindow.end = addDays(ovulationDate, 1);
                
                events = createDetailedEvents(lastPeriodDate, ovulationDate, nextPeriodDate);

            } else {
                const day = parseInt(document.getElementById('day-select-irregular').value);
                const month = parseInt(document.getElementById('month-select-irregular').value);
                const shortestCycle = parseInt(document.getElementById('shortest-cycle').value);
                const longestCycle = parseInt(document.getElementById('longest-cycle').value);
                lastPeriodDate = new Date(year, month - 1, day);

                fertileWindow.start = addDays(lastPeriodDate, shortestCycle - 18);
                fertileWindow.end = addDays(lastPeriodDate, longestCycle - 11);
                
                events.push({ date: lastPeriodDate, type: 'period', title: 'Ngày bắt đầu kỳ kinh cuối' });
                for (let d = 0; d <= daysBetween(fertileWindow.start, fertileWindow.end); d++) {
                    const currentFertileDay = addDays(fertileWindow.start, d);
                    let title = 'Ngày có khả năng thụ thai';
                    let desc = 'Đây là một trong những ngày có khả năng thụ thai của bạn.';
                    if (d === 0) {
                        title = 'Bắt đầu khoảng thời gian thụ thai';
                        desc = 'Cơ hội thụ thai bắt đầu tăng từ ngày này.';
                    }
                    if (d === daysBetween(fertileWindow.start, fertileWindow.end)) {
                        title = 'Kết thúc khoảng thời gian thụ thai';
                        desc = 'Cơ hội thụ thai giảm dần sau ngày này.';
                    }
                    events.push({ date: currentFertileDay, type: 'fertile-range', title: title, desc: desc });
                }
            }
            
            events.sort((a,b) => a.date - b.date);
            displayResults(lastPeriodDate, events, fertileWindow);
        }

        function createDetailedEvents(lastPeriodDate, ovulationDate, nextPeriodDate) {
            const events = [
                { date: lastPeriodDate, type: 'period', title: 'Ngày bắt đầu kỳ kinh nguyệt', desc: 'Chu kỳ mới của bạn bắt đầu.' },
                { date: ovulationDate, type: 'ovulation', title: 'Ngày rụng trứng', desc: 'Khả năng thụ thai cao nhất trong khoảng 24 giờ.'},
                { date: addDays(ovulationDate, 9), type: 'implantation', title: 'Ngày làm tổ dự kiến', desc: 'Nếu thụ thai, trứng có thể làm tổ trong khoảng thời gian này.' },
                { date: addDays(ovulationDate, 11), type: 'test', title: 'Ngày có thể thử thai', desc: 'Nồng độ hormone đủ cao để que thử thai có thể phát hiện.' },
                { date: nextPeriodDate, type: 'period', title: 'Ngày kinh nguyệt tiếp theo dự kiến', desc: 'Chu kỳ tiếp theo được dự đoán sẽ bắt đầu vào ngày này.' },
                { date: addDays(lastPeriodDate, 90), type: 'milestone', title: 'Kết thúc tam cá nguyệt thứ nhất', desc: 'Bạn đã hoàn thành 1/3 chặng đường thai kỳ.'},
                { date: addDays(lastPeriodDate, 189), type: 'milestone', title: 'Kết thúc tam cá nguyệt thứ hai', desc: 'Bạn đã đi được 2/3 chặng đường thai kỳ.'},
                { date: addDays(lastPeriodDate, 280), type: 'milestone', title: 'Ngày dự sinh', desc: 'Ngày dự kiến chào đón em bé của bạn.'}
            ];

            const fertileStart = addDays(ovulationDate, -5);
            const fertileEnd = addDays(ovulationDate, 1);
            for (let d = 0; d <= daysBetween(fertileStart, fertileEnd); d++) {
                const currentFertileDay = addDays(fertileStart, d);
                if (currentFertileDay.toDateString() !== ovulationDate.toDateString()) {
                     events.push({ date: currentFertileDay, type: 'fertile-range', title: 'Ngày có khả năng thụ thai', desc: 'Đây là một trong những ngày có khả năng thụ thai cao.' });
                }
            }
            return events;
        }

        function displayResults(lastPeriodDate, events, fertileWindow) {
            const container = document.getElementById('results-container');
            const nextMonthDate = new Date(lastPeriodDate.getFullYear(), lastPeriodDate.getMonth() + 1, 1);

            container.innerHTML = `
                <div id="calendars-container">
                    <div id="calendar-wrapper-current" class="calendar-wrapper"></div>
                    <div id="calendar-wrapper-next" class="calendar-wrapper"></div>
                </div>
                <div id="event-list" class="event-list"></div>
                <div id="recalculate-btn-container"><button id="recalculate-btn">Tính toán lại</button></div><div style="text-align: center;margin-top: 20px;">#Được Tạo by Mr.Hiệp</div>
            `;
            
            generateCalendar('calendar-wrapper-current', lastPeriodDate.getFullYear(), lastPeriodDate.getMonth(), events, fertileWindow);
            generateCalendar('calendar-wrapper-next', nextMonthDate.getFullYear(), nextMonthDate.getMonth(), events, fertileWindow);
            
            generateEventList(events);

            document.getElementById('recalculate-btn').addEventListener('click', () => {
                document.getElementById('results-container').style.display = 'none';
                document.querySelector('.calculator-tool').style.display = 'block';
            });

            document.getElementById('results-container').style.display = 'block';
            document.querySelector('.calculator-tool').style.display = 'none';
        }

        function generateCalendar(targetId, year, month, events, fertileWindow) {
            const wrapper = document.getElementById(targetId);
            const monthNames = ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"];
            const iconMap = { period: '💧', ovulation: '💖', implantation: '👍', test: '🧪', 'fertile-range': '❤️', milestone: '🗓️' };
            
            let calendarHTML = `
                <div class="results-header">${monthNames[month]} - ${year}</div>
                <div class="calendar-grid">
                    <div class="calendar-header">CN</div> <div class="calendar-header">T2</div> <div class="calendar-header">T3</div>
                    <div class="calendar-header">T4</div> <div class="calendar-header">T5</div> <div class="calendar-header">T6</div> <div class="calendar-header">T7</div>
                </div>
                <div class="calendar-grid">`;

            let day = new Date(year, month, 1);
            let firstDayOfWeek = day.getDay();
            day.setDate(day.getDate() - firstDayOfWeek);

            for (let i = 0; i < 42; i++) {
                let cellClass = 'calendar-day';
                if (day.getMonth() !== month) cellClass += ' other-month';
                
                let tooltip = '';
                let icon = '';

                const eventOnDay = events.find(e => e.date.toDateString() === day.toDateString());
                if (eventOnDay) {
                    cellClass += ` day-${eventOnDay.type}`;
                    tooltip = eventOnDay.title;
                    icon = iconMap[eventOnDay.type] || '';
                }

                calendarHTML += `<div class="${cellClass}" data-tooltip="${tooltip}">
                                    <span class="day-number">${day.getDate()}</span>
                                    <span class="day-icon">${icon}</span>
                                 </div>`;
                day.setDate(day.getDate() + 1);
            }

            calendarHTML += `</div>`;
            wrapper.innerHTML = calendarHTML;
        }
        function initializeTooltips() {
            const tooltipElements = document.querySelectorAll('[data-tooltip]:not([data-tooltip=""])');

            // Hàm để đóng tất cả các tooltip đang mở
            const closeAllTooltips = () => {
                tooltipElements.forEach(el => el.classList.remove('tooltip-visible'));
            };

            tooltipElements.forEach(el => {
                el.addEventListener('click', function(e) {
                    e.stopPropagation(); // Ngăn sự kiện click lan ra body
                    const isVisible = this.classList.contains('tooltip-visible');
                    closeAllTooltips(); // Luôn đóng các tooltip khác trước
                    if (!isVisible) {
                        this.classList.add('tooltip-visible'); // Hiển thị tooltip vừa click
                    }
                });
            });

            // Nếu click ra ngoài, đóng tất cả tooltip
            document.body.addEventListener('click', closeAllTooltips);
        }
        
        function generateEventList(events) {
            const listContainer = document.getElementById('event-list');
            listContainer.innerHTML = '';
            
            const uniqueEvents = [];
            const seenDates = new Set();
            events.forEach(event => {
                const dateString = event.date.toDateString();
                if (!seenDates.has(dateString)) {
                    uniqueEvents.push(event);
                    seenDates.add(dateString);
                }
            });

            uniqueEvents.sort((a,b) => a.date - b.date);

            uniqueEvents.forEach(event => {
                const iconMap = {
                    period: '💧', ovulation: '💖', implantation: '👍',
                    test: '🧪', 'fertile-range': '❤️', milestone: '🗓️'
                };
                const icon = iconMap[event.type] || '🗓️';
                const desc = event.desc ? `<p>${event.desc}</p>` : '';

                listContainer.innerHTML += `
                    <div class="event-item">
                        <div class="event-icon">${icon}</div>
                        <div class="event-details">
                            <h3>${formatDate(event.date)} - ${event.title}</h3>
                            ${desc}
                        </div>
                    </div>`;
            });
        }
    </script>
</body>
</html>
